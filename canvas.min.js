let MIN_DOC_SIZE,ctx=null,canvas=null,width=0,height=0,realWidth=0,realHeight=0,mouseX=0,mouseY=0,isDevice={mobile:/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),ios:/iPad|iPhone|iPod/.test(navigator.userAgent),android:/Android/.test(navigator.userAgent)},originArr=["topLeft","top","topRight","left","center","right","bottomLeft","bottom","bottomRight"],fontSize="12px",fontFamily="Monospace",bFill=!0,bStroke=!0,keys={},isMouseDown=!1,oldMouseX=0,oldMouseY=0,isPointerLocked=!1,mouseDirection={x:0,y:0},swipexDown=null,swipeyDown=null,swipePCEnable=!0,lastSwipe=null,bGuideLines=!1;const line=(e,t,s,i)=>{ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(s,i),bStroke&&ctx.stroke(),ctx.closePath()};function polyline(){if(arguments.length%2==0){ctx.beginPath(),arguments.length>0&&ctx.moveTo(arguments[0],arguments[1]);for(let e=2;e<arguments.length;e+=2){let t=arguments[e],s=arguments[e+1];ctx.lineTo(t,s)}bStroke&&ctx.stroke(),bFill&&ctx.fill(),ctx.closePath()}else console.error("The function polyline must take an even number of arguments")}const circle=(e,t,s)=>{ctx.beginPath(),ctx.arc(e,t,s,0,2*Math.PI),bStroke&&ctx.stroke(),bFill&&ctx.fill(),ctx.closePath()},fillRect=(e,t,s,i)=>{ctx.fillRect(e,t,s,i)},rect=(e,t,s,i)=>{ctx.rect(e,t,s,i),bFill&&ctx.fill(),bStroke&&ctx.stroke()},text=(e,t,s)=>{if(/<br>/.test(e)){let i=fontSize.replace(/(\d+)(\w+)?/,"$1");e=e.split("<br>");for(let o=0;o<e.length;o++)ctx.fillText(e[o],t,s+o*i)}else ctx.fillText(e,t,s)},setFont=(e,t)=>{ctx.font=`${e} ${t}`,fontSize=e,fontFamily=t},setFontSize=e=>{ctx.font=`${e} ${fontFamily}`,fontSize=e},setFontFamily=e=>{ctx.font=`${fontSize} ${e}`,fontFamily=e},alignText=e=>{ctx.textAlign=["left","right","center","start","end"].indexOf(e)>-1?e:"left"},push=()=>{ctx.save()},pop=()=>{ctx.restore()},translate=(e,t)=>{ctx.translate(e,t)},rotate=e=>{ctx.rotate(radians(e))},noFill=()=>{bFill=!1},noStroke=()=>{bStroke=!1},background=e=>{canvas.style.backgroundColor=e},stroke=e=>{ctx.strokeStyle=e,bStroke=!0},strokeWeight=e=>{ctx.lineWidth=e},linecap=e=>{ctx.lineCap=["butt","round","square"].indexOf(e)>-1?e:"butt"},fill=e=>{ctx.fillStyle=e,bFill=!0},clear=()=>{ctx.clearRect(0,0,canvas.width,canvas.height)},radians=e=>e*(Math.PI/180),degree=e=>e*(180/Math.PI),angleToVector=e=>new Vector(Math.cos(e),Math.sin(e)),random=e=>Math.floor(Math.random()*e),dist=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),map=(e,t,s,i,o)=>(e-t)/(s-t)*(o-i)+i,pow=e=>e*e,abs=e=>e>=0?e:-e,sqrt=e=>Math.sqrt(e);function min(){return Math.max(...arguments)}function max(){return Math.min(...arguments)}const hex=(e,t,s)=>((e=Number(e).toString(16)).length<2&&(e="0"+e),(t=Number(t).toString(16)).length<2&&(t="0"+t),(s=Number(s).toString(16)).length<2&&(s="0"+s),"#"+e+t+s),hexs=e=>{let t=parseInt(e.replace(/rgba?\((\d+),\d+,\d+(\,\d+)?\)/,"$1")),s=parseInt(e.replace(/rgba?\(\d+,(\d+),\d+(\,\d+)?\)/,"$1")),i=parseInt(e.replace(/rgba?\(\d+,\d+,(\d+)(\,\d+)?\)/,"$1"));return hex(t,s,i)},rgb=e=>(3==(e=e.replace("#","")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),"rgb("+parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4,6),16)+")"),getSwipe=()=>lastSwipe,isKeyDown=e=>keys[e],isKeyUp=e=>!keys[e],rendering=(e,t=null)=>new Vector((e instanceof Vector&&!t?e.x:e)*width/realWidth,(e instanceof Vector&&!t?e.y:t)*height/realHeight),renderingX=e=>e*width/realWidth,renderingY=e=>e*height/realHeight,mouseDir=()=>isPointerLocked?mouseDirection:mouseX>oldMouseX&&mouseY>oldMouseY?"BOTTOM_RIGHT":mouseX>oldMouseX&&mouseY<oldMouseY?"TOP_RIGHT":mouseX<oldMouseX&&mouseY<oldMouseY?"TOP_LEFT":mouseX<oldMouseX&&mouseY>oldMouseY?"BOTTOM_LEFT":mouseX>oldMouseX&&mouseY==oldMouseY?"RIGHT":mouseX==oldMouseX&&mouseY>oldMouseY?"DOWN":mouseX==oldMouseX&&mouseY<oldMouseY?"UP":mouseX<oldMouseX&&mouseY==oldMouseY?"LEFT":null,enablePCswipe=e=>{swipePCEnable="boolean"!=typeof e||e,document.removeEventListener("mousedown",handleTouchStart,!1),document.removeEventListener("mousemove",handleTouchMove,!1)};function setHTMLview(e,t){e<0||t<0||(realWidth=e,realHeight=t,canvas&&(canvas.style.width=realWidth,canvas.style.height=realHeight))}function createCanvas(e,t,s="#000",i=!1){return null!=canvas&&(document.querySelector("#"+canvas.id).remove(),canvas=null,ctx=null),canvas=document.createElement("canvas"),width=e,height=t,canvas.width=width,canvas.height=height,0==realWidth&&(realWidth=width,realHeight=height),canvas.id="dynamic-canvas",canvas.style.width=realWidth,canvas.style.height=realHeight,canvas.style.background=s,document.body.appendChild(canvas),i&&(canvas.requestPointerLock=canvas.requestPointerLock||canvas.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.addEventListener("pointerlockchange",()=>{document.pointerLockElement===canvas&&document.mozPointerLockElement===canvas||(isPointerLocked=!1)},!1),canvas.onclick=(()=>{isPointerLocked||(canvas.requestPointerLock(),isPointerLocked=!0)})),ctx=canvas.getContext("2d"),canvas}function showGuideLines(e){bGuideLines="boolean"==typeof e&&e}let drawCond=()=>!0;function setDrawCondition(e=null){e&&(drawCond=e)}function drawLoop(){ctx&&"undefined"!=typeof draw&&drawCond()&&(clear(),draw(),bGuideLines&&(fill("#46eaea"),stroke("#46eaea"),strokeWeight(1),line(0,mouseY,width,mouseY),line(mouseX,0,mouseX,height),text(`${Math.floor(mouseX)},${Math.floor(mouseY)}`,mouseX+5,mouseY-5))),requestAnimationFrame(drawLoop)}function handleTouchStart(e){isMouseDown=!0,"undefined"!=typeof mouseDown&&mouseDown(e);const t=(t=>t.touches||[{clientX:e.clientX,clientY:e.clientY},null])(e)[0];swipexDown=t.clientX,swipeyDown=t.clientY}function handleTouchMove(e){if("undefined"!=typeof mouseDown&&isMouseDown&&mouseDown(e),!swipexDown||!swipeyDown)return;let t,s;e.touches?(t=e.touches[0].clientX,s=e.touches[0].clientY):(t=e.clientX,s=e.clientY);let i,o,n=swipexDown-t,r=swipeyDown-s;Math.abs(n)>Math.abs(r)?n>0?(o="left")&&(i=new CustomEvent("swipeleft",{detail:{swipe:"left"}})):(o="right")&&(i=new CustomEvent("swiperight",{detail:{swipe:"right"}})):r>0?(o="up")&&(i=new CustomEvent("swipeup",{detail:{swipe:"up"}})):(o="down")&&(i=new CustomEvent("swipedown",{detail:{swipe:"down"}})),canvas.dispatchEvent(i),lastSwipe=o,swipexDown=null,swipeyDown=null}function getOffsetVector(e){if(!(e instanceof Shape))return console.error("Argument must be a Shape type"),new Vector(0,0);let t,s,i,o=new Vector(0,0);switch(e instanceof RectangleShape?(t=e.width/2,s=e.height/2,i=new Vector(0,0)):e instanceof CircleShape&&(s=t=e.r,i=new Vector(e.r,e.r),o.set(e.r,e.r)),e.origin){case"topLeft":o.set(-i.x,-i.y);break;case"top":o.set(t-i.x,-i.y);break;case"topRight":o.set(2*t-i.x,-i.y);break;case"left":o.set(-i.x,s-i.y);break;case"center":o.set(t-i.x,s-i.y);break;case"right":o.set(2*t-i.x,s-i.y);break;case"bottomLeft":o.set(-i.x,2*s-i.y);break;case"bottom":o.set(t-i.x,2*s-i.y);break;case"bottomRight":o.set(2*t-i.x,2*s-i.y)}return o}window.onload=(e=>{function t(e){let t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}MIN_DOC_SIZE=Math.min(document.documentElement.clientHeight,document.documentElement.clientWidth),"undefined"!=typeof setup&&setup(),canvas&&(canvas.addEventListener("mousemove",e=>{oldMouseX=mouseX,oldMouseY=mouseY,mouseX=e.clientX-t(canvas).left,mouseY=e.clientY-t(canvas).top,mouseDirection={x:e.movementX,y:e.movementY},"undefined"!=typeof mouseMove&&mouseMove(e)}),canvas.addEventListener("touchstart",handleTouchStart,!1),canvas.addEventListener("touchmove",handleTouchMove,!1),canvas.addEventListener("mouseup",e=>{isMouseDown=!1,"undefined"!=typeof mouseUp&&mouseUp(e)}),swipePCEnable&&(canvas.addEventListener("mousedown",handleTouchStart,!1),canvas.addEventListener("mousemove",handleTouchMove,!1)),"undefined"!=typeof onSwipe&&(canvas.addEventListener("swipeleft",onSwipe,!1),canvas.addEventListener("swiperight",onSwipe,!1),canvas.addEventListener("swipeup",onSwipe,!1),canvas.addEventListener("swipedown",onSwipe,!1)),canvas.addEventListener("mouseenter",e=>{"undefined"!=typeof mouseEnter&&mouseEnter(e)}),canvas.addEventListener("mouseleave",e=>{"undefined"!=typeof mouseLeave&&mouseLeave(e)}),canvas.addEventListener("wheel",e=>{"undefined"!=typeof mouseWheel&&mouseWheel(e)})),window.onkeypress=(e=>{keys[e.code]=!0,"undefined"!=typeof keyPress&&keyPress(e)}),window.onkeydown=(e=>{keys[e.code]=!0,"undefined"!=typeof keyDown&&keyDown(e)}),window.onkeyup=(e=>{keys[e.code]=!1,"undefined"!=typeof keyUp&&keyUp(e)}),drawLoop()});class Vector{constructor(e,t){this.x=e,this.y=t}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y);0!=e&&(this.x=this.x/e,this.y=this.y/e)}set(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}get mag(){return Math.hypot(this.x,this.y)}setMag(e){this.x=this.x*e/this.mag,this.y=this.y*e/this.mag}toString(){return`{x: ${this.x}, y: ${this.y}}`}}function collision(e,t){if(!(e instanceof Shape&&t instanceof Shape))return void console.error("Collision is only for 2 Shape types");function s(e,t){i=getOffsetVector(e),o=getOffsetVector(t);let s=t.x-o.x,n=t.y-o.y,r=e.x-i.x,h=e.y-i.y,a=s<r?r:s>r+e.width?r+e.width:s,c=n<h?h:n>h+e.height?h+e.height:n;return sqrt(pow(s-a)+pow(n-c))<=t.r}let i=getOffsetVector(e),o=getOffsetVector(t),n=e.x-i.x,r=e.y-i.y,h=t.x-o.x,a=t.y-o.y;if(e instanceof RectangleShape){if(t instanceof RectangleShape)return function(e,t){let s=n+e.width,i=r+e.height,o=h+t.width,c=a+t.height;return n<o&&s>h&&r<c&&i>a}(e,t);if(t instanceof CircleShape)return s(e,t)}else if(e instanceof CircleShape){if(t instanceof CircleShape)return function(e,t){let s=n-h,i=r-a;return sqrt(s*s+i*i)<e.r+t.r}(e,t);if(t instanceof RectangleShape)return s(t,e)}return!1}class Shape{constructor(e,t,s="transparent",i="transparent",o=1){this.pos=new Vector(e,t),this.style={background:s,stroke:i,strokeWeight:o},this.drawOrigin=!1,this.speed=0,this.acceleration=0,this.isRunning=!1,this.origin="topLeft"}set fill(e){this.style.background=e}set stroke(e){this.style.stroke=e}set strokeWeight(e){this.style.strokeWeight=e}set run(e){this.running="boolean"==typeof e&&e}get background(){return this.style.background}get stroke(){return this.style.stroke}get strokeWeight(){return this.style.strokeWeight}get x(){return this.pos.x}get y(){return this.pos.y}get running(){return this.isRunning}showOrigin(e){this.drawOrigin="boolean"==typeof e&&e}setOrigin(e){this.origin=originArr.indexOf(e)?e:"topLeft"}setPosition(e,t=null){!t&&e instanceof Vector?(this.pos.x=e.x,this.pos.y=e.y):(this.pos.x=e,this.pos.y=t)}move(e,t){let s=this.speed+(this.running?this.acceleration:0);!t&&e instanceof Vector?(this.pos.x+=e.x*s,this.pos.y+=e.y*s):(this.pos.x+=e*s,this.pos.y+=t*s)}}class RectangleShape extends Shape{constructor(e,t,s,i,o="black",n="transparent",r=1){super(e,t,o,n,r),this.dim=new Vector(s,i)}get width(){return this.dim.x}get height(){return this.dim.y}set width(e){this.dim.x=e}set height(e){this.dim.y=e}draw(){fill(this.background),stroke(this.stroke),strokeWeight(this.strokeWeight);let e=getOffsetVector(this);fillRect(this.x-e.x,this.y-e.y,this.width,this.height),line(this.x-e.x-this.strokeWeight/2,this.y-e.y,this.x-e.x+this.width+this.strokeWeight/2,this.y-e.y),line(this.x-e.x-this.strokeWeight/2,this.y-e.y+this.height,this.x-e.x+this.width+this.strokeWeight/2,this.y-e.y+this.height),line(this.x-e.x,this.y-e.y,this.x-e.x,this.y-e.y+this.height),line(this.x-e.x+this.width,this.y-e.y,this.x-e.x+this.width,this.y-e.y+this.height),this.drawOrigin&&(fill("#0F8"),noStroke(),circle(this.x,this.y,2))}hover(){let e=getOffsetVector(this),t=this.x-e.x,s=this.y-e.y,i=t+this.width,o=s+this.height;return t<=mouseX&&mouseX<=i&&s<=mouseY&&mouseY<=o}}class CircleShape extends Shape{constructor(e,t,s,i="black",o="transparent",n=1){super(e,t,i,o,n),this.radius=s,this.origin="center"}get r(){return this.radius}set r(e){this.radius=e}draw(){fill(this.background),stroke(this.stroke),strokeWeight(this.strokeWeight);let e=getOffsetVector(this);circle(this.x-e.x,this.y-e.y,this.r),this.drawOrigin&&(fill("#0F8"),noStroke(),circle(this.x,this.y,2))}hover(){let e=getOffsetVector(this);return pow(mouseX-this.x-e.x)+pow(mouseY-this.y-e.y)<pow(this.r)}}class TriangleShape extends Shape{constructor(e,t,s,i,o,n,r="black",h="transparent",a=1){super(e,t,r,h,a),this.baseLength=s,this.baseTilt=radians(i),this.height=o,this.heightPos=n,this.origin="bottomLeft",this.vertex={A:new Vector(0,0),B:new Vector(0,0),C:new Vector(0,0)},this.refreshVertexPos()}get A(){return this.vertex.A}get B(){return this.vertex.B}get C(){return this.vertex.C}draw(){this.refreshVertexPos(),fill(this.background),stroke(this.stroke),strokeWeight(this.strokeWeight),polyline(this.A.x,this.A.y,this.B.x,this.B.y,this.C.x,this.C.y,this.vertex.A.x,this.A.y),this.drawOrigin&&(fill("#0F8"),noStroke(),circle(this.x,this.y,2))}refreshVertexPos(){let e=angleToVector(this.baseTilt);this.vertex.A.set(this.x,this.y),this.vertex.B.set(this.A.x+this.baseLength*e.x,this.A.y+this.baseLength*e.y);let t=dist(this.A,this.B)/2,s=new Vector(this.A.x+t*e.x,this.A.y+t*e.y),i=angleToVector(radians(degree(this.baseTilt)-90));this.vertex.C.set(s.x+this.height*i.x,s.y+this.height*i.y,5)}hover(){let e=abs((this.B.x-this.A.x)*(this.C.y-this.A.y)-(this.C.x-this.A.x)*(this.B.y-this.A.y));return abs((this.A.x-mouseX)*(this.B.y-mouseY)-(this.B.x-mouseX)*(this.A.y-mouseY))+abs((this.B.x-mouseX)*(this.C.y-mouseY)-(this.C.x-mouseX)*(this.B.y-mouseY))+abs((this.C.x-mouseX)*(this.A.y-mouseY)-(this.A.x-mouseX)*(this.C.y-mouseY))==e}}class Triangle extends TriangleShape{constructor(e,t,s,i,o,n,r="black",h="black",a=1){let c=new Vector(e,t),l=new Vector(s,i),u=new Vector(o,n),d=degree(Math.atan2(l.y-c.y,l.x-c.x)),g=dist(c,l),x=angleToVector(radians(d)),y=new Vector(c.x+g/2*x.x,c.y+g/2*x.y),p=dist(y,u),m=u.x-c.x;super(c.x,c.y,g,d,p,m,r,h,a)}}